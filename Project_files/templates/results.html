{% extends 'base.html' %}

{% block content %}


    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDM8o4QXXEl_KvhpVuTL9S5OV-47bqQa80&callback=initMap" async defer></script>
    <script src="static/js/google_map.js"></script>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="static/js/d3_bubbles.js"></script>
    




    <h2> Results </h2>
    <p id="headline">  <p/>


    <div id="map"></div></br>

    <form action="/selected" id="results"></form>


    <script>
        function showResults(results){
                        console.log("yay");
                        console.log(results);
                        businesses = results;

                        addDivs(businesses);
                        addMarker(businesses);
        };


        var searchParams = {
            location : $('#city').val(),
            category : $('#search-category').val()
        };

        $.get('/restaurants_search.json', searchParams, showResults );

        function addDivs(businesses){
            var sum_lats=0;
            var sum_lngs=0;
            var cnt_elems =0;
                for (var business in businesses) {
                    $('#results').append('<div class="business details" id="'+business+
                                    '">'+ businesses[business]['name']+' '+businesses[business]['stars']+' stars </div></br>')
                    $('#results').append('<div class="business_bubbles" id=bubbles'+business+
                                    '></div></br>')


                    multiD3(businesses[business]['nlp_keywords'], "bubbles"+business);
                    $('#'+business).append('<p>'+businesses[business]['nlp_summary']+'</p></br>')
                
                    $('#results').append('<input class="finalpicks"  type="checkbox" value="'+businesses[business]['business_id'] +'" name=cbox_'+business +'>')

                    sum_lats+=businesses[business]['latitude']
                    sum_lngs+=businesses[business]['longitude']
                    cnt_elems++

            }
            $('#results').append('<button type="submit" id="chosen_biz" >Show Me!</button >')
            console.log((sum_lats/cnt_elems),( sum_lngs/cnt_elems))
            initMap(centerMap={lat: (sum_lats/cnt_elems), lng: ( sum_lngs/cnt_elems)})
        }
    </script>


{% endblock %}


